<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMH Admin ç™»å½•</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const { createApp, ref, reactive, computed, onMounted } = Vue;

        const LoginApp = {
            setup() {
                const isLoggedIn = ref(!!localStorage.getItem('dmh_token'));
                const loginForm = reactive({
                    username: '',
                    password: ''
                });
                const loginError = ref('');
                const loginLoading = ref(false);

                // å¿«é€Ÿå¡«å……åŠŸèƒ½
                const quickFillAdmin = () => {
                    loginForm.username = 'admin';
                    loginForm.password = '123456';
                    loginError.value = '';
                };

                const quickFillBrandManager = () => {
                    loginForm.username = 'brand_manager';
                    loginForm.password = '123456';
                    loginError.value = '';
                };

                // ç™»å½•å¤„ç†
                const handleLogin = async () => {
                    console.log('å¼€å§‹ç™»å½•...', { username: loginForm.username });
                    
                    if (!loginForm.username || !loginForm.password) {
                        loginError.value = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                        return;
                    }

                    loginLoading.value = true;
                    loginError.value = '';
                    
                    try {
                        const response = await fetch('/api/v1/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                username: loginForm.username,
                                password: loginForm.password
                            })
                        });
                        
                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                        }
                        
                        const result = await response.json();
                        console.log('ç™»å½•æˆåŠŸ:', result);
                        
                        // ä¿å­˜token
                        if (result.token) {
                            localStorage.setItem('dmh_token', result.token);
                            isLoggedIn.value = true;
                            
                            // è·³è½¬åˆ°åŸå§‹adminé¡µé¢
                            window.location.href = 'http://localhost:3000';
                        }
                        
                    } catch (error) {
                        console.error('ç™»å½•å¤±è´¥:', error);
                        loginError.value = error.message || 'ç™»å½•å¤±è´¥';
                    } finally {
                        loginLoading.value = false;
                    }
                };

                // é€€å‡ºç™»å½•
                const handleLogout = () => {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        localStorage.removeItem('dmh_token');
                        isLoggedIn.value = false;
                    }
                };

                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                const checkLoginStatus = () => {
                    isLoggedIn.value = !!localStorage.getItem('dmh_token');
                };

                onMounted(() => {
                    checkLoginStatus();
                });

                return {
                    isLoggedIn,
                    loginForm,
                    loginError,
                    loginLoading,
                    quickFillAdmin,
                    quickFillBrandManager,
                    handleLogin,
                    handleLogout,
                    checkLoginStatus
                };
            },
            template: `
                <div class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex items-center justify-center p-4">
                    <!-- å·²ç™»å½•çŠ¶æ€ -->
                    <div v-if="isLoggedIn" class="w-full max-w-md">
                        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8 text-center">
                            <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <h1 class="text-2xl font-black text-slate-900 mb-2">ç™»å½•æˆåŠŸ</h1>
                            <p class="text-slate-500 mb-8">æ‚¨å·²æˆåŠŸç™»å½•DMHç®¡ç†åå°</p>
                            
                            <div class="space-y-3">
                                <a href="http://localhost:3000" 
                                   class="block w-full bg-indigo-600 text-white py-3 rounded-2xl font-bold hover:bg-indigo-700 transition-colors">
                                    ğŸ–¥ï¸ è¿›å…¥ç®¡ç†åå°
                                </a>
                                <button @click="handleLogout"
                                        class="w-full bg-slate-100 text-slate-700 py-3 rounded-2xl font-bold hover:bg-slate-200 transition-colors">
                                    ğŸšª é€€å‡ºç™»å½•
                                </button>
                                <button @click="checkLoginStatus"
                                        class="w-full bg-amber-100 text-amber-800 py-2 rounded-2xl font-bold hover:bg-amber-200 transition-colors text-sm">
                                    ğŸ”„ åˆ·æ–°çŠ¶æ€
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æœªç™»å½•çŠ¶æ€ -->
                    <div v-else class="w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <h1 class="text-3xl font-black text-slate-900 mb-2">DMH æ•°å­—è¥é”€ä¸­å°</h1>
                            <p class="text-slate-500">ç™»å½•æ‚¨çš„ç®¡ç†è´¦æˆ·</p>
                        </div>
                        
                        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8">
                            <!-- é”™è¯¯æç¤º -->
                            <div v-if="loginError" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-2xl flex items-start gap-3">
                                <svg class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="text-sm text-red-800">{{ loginError }}</div>
                            </div>
                            
                            <!-- ç™»å½•è¡¨å• -->
                            <form @submit.prevent="handleLogin" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-2">ç”¨æˆ·å</label>
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            </svg>
                                        </div>
                                        <input
                                            type="text"
                                            v-model="loginForm.username"
                                            placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                                            class="w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all"
                                            required
                                        />
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-2">å¯†ç </label>
                                    <div class="relative">
                                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                            </svg>
                                        </div>
                                        <input
                                            type="password"
                                            v-model="loginForm.password"
                                            placeholder="è¯·è¾“å…¥å¯†ç "
                                            class="w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all"
                                            required
                                            minlength="6"
                                        />
                                    </div>
                                </div>
                                
                                <button
                                    type="submit"
                                    :disabled="loginLoading"
                                    class="w-full py-4 rounded-2xl font-bold text-white transition-all"
                                    :class="loginLoading ? 'bg-slate-300 cursor-not-allowed' : 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 shadow-lg hover:shadow-xl'"
                                >
                                    {{ loginLoading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
                                </button>
                            </form>
                            
                            <!-- æµ‹è¯•è´¦å·å¿«é€Ÿå¡«å…… -->
                            <div class="mt-8">
                                <div class="p-4 bg-amber-50 border border-amber-200 rounded-2xl">
                                    <p class="text-amber-800 font-bold mb-2 text-center">âš ï¸ æµ‹è¯•è´¦å·</p>
                                    <div class="text-amber-700 text-xs space-y-1 text-center">
                                        <p>ç®¡ç†å‘˜: admin / 123456</p>
                                        <p>å“ç‰Œç®¡ç†å‘˜: brand_manager / 123456</p>
                                    </div>
                                    <div class="flex gap-2 mt-3">
                                        <button
                                            type="button"
                                            @click="quickFillAdmin"
                                            class="flex-1 px-3 py-2 bg-amber-100 text-amber-800 rounded-xl text-xs font-bold hover:bg-amber-200 transition-colors"
                                        >
                                            å¡«å……ç®¡ç†å‘˜
                                        </button>
                                        <button
                                            type="button"
                                            @click="quickFillBrandManager"
                                            class="flex-1 px-3 py-2 bg-amber-100 text-amber-800 rounded-xl text-xs font-bold hover:bg-amber-200 transition-colors"
                                        >
                                            å¡«å……å“ç‰Œç®¡ç†å‘˜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- åº•éƒ¨é“¾æ¥ -->
                            <div class="mt-8 text-center text-sm text-slate-500">
                                <p class="mb-2">é‡åˆ°é—®é¢˜è¯·è”ç³»æŠ€æœ¯æ”¯æŒ</p>
                                <div class="flex justify-center gap-4 text-xs">
                                    <a href="http://localhost:3100/brand/login" class="text-indigo-600 hover:text-indigo-500">å“ç‰ŒH5ç™»å½•</a>
                                    <a href="http://localhost:8080/test-login.html" class="text-indigo-600 hover:text-indigo-500">ç™»å½•çŠ¶æ€æµ‹è¯•</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        };

        createApp(LoginApp).mount('#app');
    </script>
</body>
</html>