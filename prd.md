DMH 数字营销枢纽 PRD (MVP 细化版)
1. 产品基本信息
技术栈：Go-Zero (Backend) + MySQL 8 (DB) + Vue3 (Admin) + Vue3 H5 (C端落地页，原规划 Uni-app 已调整为纯 Vue 实现)
核心场景：快速创建营销活动，通过社交渠道获客，数据实时同步至外网既有系统，并实现推广奖励实时计算。
2. 详细功能模块需求
2.1 营销活动管理（B端 - 后台）
目的：提供活动配置入口，支持动态字段定义。
功能点	需求细化描述	业务逻辑/约束
活动列表	分页展示所有营销活动，包含状态（进行中、已结束、禁用）。	支持简单的名称搜索。
活动配置	基础信息：标题、开始/结束时间、主图展示、活动简介。	必填项检查。
动态表单生成	运营通过勾选方式确定用户需填写字段：<br>	
<br>1. 姓名 (String)<br>
<br>2. 手机号 (Number, 带校验)<br>
<br>3. 意向课程 (Select) | 不支持文件上传。表单配置以 JSON 格式存储于 MySQL 8。 |
| 奖励规则设定 | 输入“邀请奖励金额”。<br>
<br>例如：每推荐一个新用户成功支付，推荐人账户增加 5 元。 | 实时计算。MVP 阶段奖励仅记录在系统余额，不涉及自动打款。 |
| 支付参数 | 设定活动报名费用（0元或固定金额）。 | 关联微信支付商户号。 |
2.2 触达与裂变工具（C端 - 移动端）
目的：低门槛分享，自动追踪来源。
功能点	需求细化描述	业务逻辑/约束
全渠道落地页	Vue 3 H5 单页应用，自适应微信浏览器、抖音 App、普通浏览器。	根据浏览器 UA 自动适配分享入口（后续可扩展小程序）。
来源追踪	访问 URL 自动解析 c_id (渠道ID) 和 u_id (推荐人ID)。	存入 Session/Storage，确保用户支付时能关联推荐关系。
专属海报合成	后端 Go 服务调用 fogleman/gg 或类似库实时合成，生成 PNG 文件并提供访问 URL。	合成内容：背景图 + 活动标题 + 带推荐人参数的二维码；MVP 阶段存储于本地 `/backend/storage/posters`，对外暴露 `POST /api/v1/qrcode/generate`。
身份授权	微信内支持静默获取 OpenID，手机号支持组件一键授权。	降低用户填写负担。
2.3 订单与奖励系统（后端 - 服务端）
目的：确保交易安全及奖励计算的准确性。
功能点	需求细化描述	业务逻辑/约束
支付回调处理	监听微信支付回调通知。	需处理幂等性，防止重复结算。
实时奖励结算	支付成功后，事务内触发：<br>	
<br>1. 标记报名成功<br>
<br>2. 实时计算推荐人奖励并入库。 | 奖励记录包含：时间、被推荐人、奖励金额、关联活动。 |
| 自动凭证 | 支付后展示“报名成功码”及引导信息。 | 信息从活动配置的“成功引导”字段读取。 |
2.4 外网数据集成适配器（Integration Adapter）
目的：替代 ESB，实现数据实时写回旧系统。
功能点	需求细化描述	业务逻辑/约束
外网直连驱动	Go 直接通过 DSN 连接外网 Oracle/SQLServer。	需支持连接池管理及超时断开处理。
新增同步逻辑	支付成功后，将表单 JSON 数据解析为 SQL。	仅限新增 (INSERT)，不进行修改或删除操作。
字段映射映射	简单的映射规则配置。	如：dmh.name -> old_sys.student_name。
同步状态监控	记录每条数据的同步状态：待同步、成功、失败（含错误日志）。	提供“一键重试”功能解决公网波动问题。
3. 数据表设计 (MySQL 8 核心)
dmh_campaign：存储活动主信息，字段 form_schema (JSON) 记录表单结构。
dmh_order：存储交易流水，字段 ext_info (JSON) 存储用户填写的动态表单内容。
dmh_reward_record：存储实时计算的推广奖励明细。
dmh_sync_log：记录外网数据库写回的日志。
4. 业务确认与关键规则 (Business Rules)
去重规则：同一活动下，同一手机号仅允许报名成功一次。
实时性要求：
奖励计算：支付成功后 2 秒内完成。
数据同步：异步处理，允许 1 分钟内的延迟，但必须有失败记录。
安全规则：外网数据库连接必须限定 DMH 服务器 IP，且 Go 后端配置加密存储数据库密码。
MVP 边界：不涉及用户退款流程自动化（手动处理）、不涉及多级分销（仅限一级推荐）。
5. 1周开发里程碑 (Timeline)
Day 1：环境搭建，MySQL 建表，Go-Zero API 定义。
Day 2：后台活动管理 API 开发，动态表单 JSON 存储逻辑，并启动 Vue3 管理后台「活动管理」界面（列表 + 编辑，优先打通后端接口）。
Day 3：支付回调、实时奖励计算逻辑、海报合成服务。
Day 4：外网数据库适配器开发（Oracle/SQLServer 写入测试）。
Day 5：Uni-app C端落地页开发（含支付与分享）。
Day 6：Vue3 后台界面联调，全链路跑通。
Day 7：线上环境部署，业务压力测试，交付 MVP。
实现策略：管理后台（Vue3 Admin）优先落地，先打通「活动管理」后台的真实接口，再在 Day 5 启动 Uni-app H5 开发。
项目创建第一个 OpenSpec 变更，请先帮我生成 proposal