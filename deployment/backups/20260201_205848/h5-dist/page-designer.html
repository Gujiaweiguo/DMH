<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMH 页面设计器</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        .header h1 { font-size: 18px; font-weight: 600; }
        .header-actions button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        .header-actions button:hover { background: rgba(255,255,255,0.3); }

        .container {
            display: flex;
            margin-top: 60px;
            height: calc(100vh - 60px);
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e5e7eb;
            padding: 20px;
            overflow-y: auto;
        }
        .sidebar-title { font-size: 14px; font-weight: 600; margin-bottom: 15px; color: #333; }
        .component-list { display: flex; flex-direction: column; gap: 10px; }
        .component-item {
            padding: 12px 15px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: grab;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }
        .component-item:hover {
            background: #f0f9ff;
            border-color: #667eea;
            transform: translateX(5px);
        }
        .component-item i { font-size: 18px; color: #667eea; }
        .component-item span { font-size: 14px; color: #374151; }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
        }
        .toolbar button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        .toolbar button:hover { background: #5a67d8; }
        .toolbar button.secondary { background: #9ca3af; }
        .toolbar button.secondary:hover { background: #6b7280; }

        .design-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .component-wrapper {
            background: white;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            padding: 40px 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .component-wrapper.drag-over { border-color: #667eea; background: #f0f9ff; }

        .design-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            cursor: move;
        }
        .design-item:hover { border-color: #667eea; }
        .design-item.selected { border: 2px solid #667eea; }
        .design-item .delete-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ef4444;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .design-item:hover .delete-btn { display: flex; }

        .config-panel {
            width: 320px;
            background: white;
            border-left: 1px solid #e5e7eb;
            padding: 20px;
            overflow-y: auto;
        }
        .config-panel h3 { font-size: 16px; font-weight: 600; margin-bottom: 20px; color: #333; }
        .config-group { margin-bottom: 20px; }
        .config-group label { display: block; font-size: 13px; font-weight: 500; color: #4b5563; margin-bottom: 8px; }
        .config-group input,
        .config-group textarea,
        .config-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .config-group textarea { min-height: 80px; resize: vertical; }
        .config-group input:focus { outline: none; border-color: #667eea; }
        .config-row { display: flex; gap: 10px; }
        .config-row .config-group { flex: 1; }

        .preview-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .preview-modal.active { display: flex; }
        .preview-frame {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: auto;
        }
        .preview-header {
            padding: 15px 20px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .preview-content { padding: 20px; }
        .preview-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 3000;
            display: none;
        }
        .toast.show { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateX(-50%) translateY(10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }

        /* 组件预览样式 */
        .preview-banner { width: 100%; border-radius: 8px; overflow: hidden; }
        .preview-banner img { width: 100%; display: block; }
        .preview-text { padding: 15px; background: #fff; }
        .preview-text h3 { margin-bottom: 10px; color: #333; }
        .preview-text p { color: #666; line-height: 1.6; }
        .preview-video { width: 100%; border-radius: 8px; overflow: hidden; background: #000; }
        .preview-countdown {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        .preview-countdown .timer { font-size: 32px; font-weight: 700; margin: 15px 0; }
        .preview-review { padding: 15px; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; }
        .preview-review .avatar { width: 40px; height: 40px; background: #667eea; border-radius: 50%; margin-right: 10px; }
        .preview-review .name { font-weight: 600; color: #333; }
        .preview-review .content { color: #666; font-size: 14px; margin-top: 5px; }
        .preview-faq { padding: 15px; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; }
        .preview-faq .question { font-weight: 600; color: #333; margin-bottom: 8px; }
        .preview-faq .answer { color: #666; font-size: 14px; }
        .preview-contact { padding: 20px; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; }
        .preview-social { display: flex; gap: 15px; justify-content: center; padding: 20px; background: #fff; border-radius: 8px; }
        .preview-social a { width: 50px; height: 50px; background: #667eea; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="ri-layout-masonry-line"></i> DMH 页面设计器</h1>
        <div class="header-actions">
            <button onclick="window.location.href='/brand/login'"><i class="ri-arrow-left-line"></i> 返回</button>
            <button onclick="previewPage()"><i class="ri-eye-line"></i> 预览</button>
            <button onclick="saveConfig()"><i class="ri-save-line"></i> 保存</button>
        </div>
    </div>

    <div class="container">
        <!-- 组件库 -->
        <div class="sidebar">
            <div class="sidebar-title">组件库</div>
            <div class="component-list">
                <div class="component-item" draggable="true" data-type="banner">
                    <i class="ri-image-line"></i>
                    <span>横幅图片</span>
                </div>
                <div class="component-item" draggable="true" data-type="text">
                    <i class="ri-text"></i>
                    <span>文本内容</span>
                </div>
                <div class="component-item" draggable="true" data-type="video">
                    <i class="ri-video-line"></i>
                    <span>视频播放</span>
                </div>
                <div class="component-item" draggable="true" data-type="countdown">
                    <i class="ri-time-line"></i>
                    <span>倒计时</span>
                </div>
                <div class="component-item" draggable="true" data-type="reviews">
                    <i class="ri-star-line"></i>
                    <span>用户评价</span>
                </div>
                <div class="component-item" draggable="true" data-type="faq">
                    <i class="ri-question-line"></i>
                    <span>常见问题</span>
                </div>
                <div class="component-item" draggable="true" data-type="contact">
                    <i class="ri-phone-line"></i>
                    <span>联系方式</span>
                </div>
                <div class="component-item" draggable="true" data-type="social">
                    <i class="ri-share-line"></i>
                    <span>社交媒体</span>
                </div>
            </div>
        </div>

        <!-- 主设计区 -->
        <div class="main-area">
            <div class="toolbar">
                <button onclick="previewPage()"><i class="ri-eye-line"></i> 实时预览</button>
                <button onclick="saveConfig()"><i class="ri-save-line"></i> 保存配置</button>
                <button class="secondary" onclick="clearAll()"><i class="ri-delete-bin-line"></i> 清空</button>
            </div>
            <div class="design-area">
                <div class="component-wrapper" id="designArea">
                    <div style="text-align: center; color: #9ca3af; padding: 40px;" id="emptyTip">
                        <i class="ri-drag-move-line" style="font-size: 48px;"></i>
                        <p style="margin-top: 15px;">从左侧拖拽组件到这里</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 配置面板 -->
        <div class="config-panel" id="configPanel">
            <h3><i class="ri-settings-3-line"></i> 组件配置</h3>
            <div id="configContent">
                <p style="color: #9ca3af; text-align: center; padding: 40px;">选择组件以编辑配置</p>
            </div>
        </div>
    </div>

    <!-- 预览模态框 -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-frame">
            <div class="preview-header">
                <h3><i class="ri-eye-line"></i> 页面预览</h3>
                <button class="preview-close" onclick="closePreview()">&times;</button>
            </div>
            <div class="preview-content" id="previewContent">
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = '/api/v1';
        const urlParams = new URLSearchParams(window.location.search);
        const campaignId = urlParams.get('campaignId');

        let components = [];
        let theme = {
            primaryColor: '#667eea',
            fontFamily: 'system-ui',
            fontSize: '16px'
        };
        let selectedComponentId = null;
        let draggedType = null;

        // 组件配置模板
        const componentTemplates = {
            banner: {
                type: 'banner',
                props: {
                    imageUrl: 'https://via.placeholder.com/800x300/667eea/ffffff?text=Banner+Image',
                    height: 300,
                    linkUrl: '',
                    title: '横幅标题'
                }
            },
            text: {
                type: 'text',
                props: {
                    title: '文本标题',
                    content: '这是文本内容，您可以编辑这里的文字。',
                    fontSize: 16,
                    textAlign: 'left'
                }
            },
            video: {
                type: 'video',
                props: {
                    videoUrl: 'https://www.w3schools.com/html/mov_bbb.mp4',
                    posterUrl: '',
                    autoplay: false,
                    width: '100%'
                }
            },
            countdown: {
                type: 'countdown',
                props: {
                    title: '活动倒计时',
                    endTime: '',
                    style: 'gradient'
                }
            },
            reviews: {
                type: 'reviews',
                props: {
                    title: '用户评价',
                    reviews: [
                        { name: '张三', content: '非常棒的产品！', avatar: 'https://via.placeholder.com/40' },
                        { name: '李四', content: '体验很好，推荐！', avatar: 'https://via.placeholder.com/40' }
                    ]
                }
            },
            faq: {
                type: 'faq',
                props: {
                    title: '常见问题',
                    items: [
                        { question: '如何参与活动？', answer: '点击下方按钮即可参与活动' },
                        { question: '活动规则是什么？', answer: '详见活动页面说明' }
                    ]
                }
            },
            contact: {
                type: 'contact',
                props: {
                    title: '联系我们',
                    phone: '400-888-8888',
                    email: 'support@example.com',
                    address: '北京市朝阳区XX街道XX号'
                }
            },
            social: {
                type: 'social',
                props: {
                    title: '关注我们',
                    platforms: [
                        { name: '微信', icon: 'ri-wechat-fill', url: '#' },
                        { name: '微博', icon: 'ri-weibo-fill', url: '#' }
                    ]
                }
            }
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            if (!campaignId) {
                alert('缺少活动ID参数');
                window.location.href = '/brand/login';
                return;
            }
            initDragDrop();
            loadConfig();
        });

        // 初始化拖拽
        function initDragDrop() {
            const items = document.querySelectorAll('.component-item');
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedType = item.dataset.type;
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });

            const designArea = document.getElementById('designArea');
            designArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                designArea.classList.add('drag-over');
            });

            designArea.addEventListener('dragleave', () => {
                designArea.classList.remove('drag-over');
            });

            designArea.addEventListener('drop', (e) => {
                e.preventDefault();
                designArea.classList.remove('drag-over');
                if (draggedType) {
                    addComponent(draggedType);
                }
            });
        }

        // 添加组件
        function addComponent(type) {
            const template = JSON.parse(JSON.stringify(componentTemplates[type]));
            const component = {
                id: Date.now().toString(),
                type: type,
                order: components.length,
                props: template.props
            };
            components.push(component);
            renderComponents();
        }

        // 渲染组件列表
        function renderComponents() {
            const designArea = document.getElementById('designArea');
            const emptyTip = document.getElementById('emptyTip');

            // 按order排序
            components.sort((a, b) => a.order - b.order);

            // 清空现有内容（保留emptyTip）
            const existingItems = designArea.querySelectorAll('.design-item');
            existingItems.forEach(item => item.remove());

            if (components.length === 0) {
                emptyTip.style.display = 'block';
                return;
            }

            emptyTip.style.display = 'none';

            components.forEach(comp => {
                const item = document.createElement('div');
                item.className = 'design-item' + (selectedComponentId === comp.id ? ' selected' : '');
                item.innerHTML = `
                    <button class="delete-btn" onclick="removeComponent('${comp.id}')">&times;</button>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <i style="font-size:18px;color:#667eea">${getComponentIcon(comp.type)}</i>
                        <strong>${getComponentName(comp.type)}</strong>
                    </div>
                    <p style="color:#666;font-size:12px;margin-top:5px;">${getComponentDesc(comp)}</p>
                `;
                item.onclick = () => selectComponent(comp.id);
                item.draggable = true;
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('moveId', comp.id);
                });
                item.addEventListener('dragover', (e) => e.preventDefault());
                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const moveId = e.dataTransfer.getData('moveId');
                    moveComponent(moveId, comp.id);
                });
                designArea.appendChild(item);
            });
        }

        // 获取组件图标
        function getComponentIcon(type) {
            const icons = {
                banner: 'ri-image-line',
                text: 'ri-text',
                video: 'ri-video-line',
                countdown: 'ri-time-line',
                reviews: 'ri-star-line',
                faq: 'ri-question-line',
                contact: 'ri-phone-line',
                social: 'ri-share-line'
            };
            return `<i class="${icons[type] || 'ri-layout-line'}"></i>`;
        }

        // 获取组件名称
        function getComponentName(type) {
            const names = {
                banner: '横幅图片',
                text: '文本内容',
                video: '视频播放',
                countdown: '倒计时',
                reviews: '用户评价',
                faq: '常见问题',
                contact: '联系方式',
                social: '社交媒体'
            };
            return names[type] || type;
        }

        // 获取组件描述
        function getComponentDesc(comp) {
            const props = comp.props;
            if (comp.type === 'banner') return props.title;
            if (comp.type === 'text') return props.title;
            if (comp.type === 'video') return props.videoUrl;
            if (comp.type === 'countdown') return props.title;
            if (comp.type === 'reviews') return `${props.reviews.length} 条评价`;
            if (comp.type === 'faq') return `${props.items.length} 个问题`;
            if (comp.type === 'contact') return props.phone;
            if (comp.type === 'social') return `${props.platforms.length} 个平台`;
            return '';
        }

        // 选择组件
        function selectComponent(id) {
            selectedComponentId = id;
            renderComponents();
            renderConfigPanel(id);
        }

        // 渲染配置面板
        function renderConfigPanel(id) {
            const comp = components.find(c => c.id === id);
            if (!comp) return;

            const configContent = document.getElementById('configContent');
            let html = '';

            switch (comp.type) {
                case 'banner':
                    html = renderBannerConfig(comp);
                    break;
                case 'text':
                    html = renderTextConfig(comp);
                    break;
                case 'video':
                    html = renderVideoConfig(comp);
                    break;
                case 'countdown':
                    html = renderCountdownConfig(comp);
                    break;
                case 'reviews':
                    html = renderReviewsConfig(comp);
                    break;
                case 'faq':
                    html = renderFaqConfig(comp);
                    break;
                case 'contact':
                    html = renderContactConfig(comp);
                    break;
                case 'social':
                    html = renderSocialConfig(comp);
                    break;
            }

            configContent.innerHTML = html;

            // 绑定事件
            configContent.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('change', (e) => {
                    const prop = e.target.dataset.prop;
                    if (prop) {
                        comp.props[prop] = e.target.value;
                        renderComponents();
                    }
                });
            });
        }

        // 渲染各组件配置表单
        function renderBannerConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <div class="config-group">
                    <label>图片URL</label>
                    <input type="text" data-prop="imageUrl" value="${comp.props.imageUrl}">
                </div>
                <div class="config-group">
                    <label>链接URL</label>
                    <input type="text" data-prop="linkUrl" value="${comp.props.linkUrl}">
                </div>
                <div class="config-group">
                    <label>高度 (px)</label>
                    <input type="number" data-prop="height" value="${comp.props.height}">
                </div>
            `;
        }

        function renderTextConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <div class="config-group">
                    <label>内容</label>
                    <textarea data-prop="content">${comp.props.content}</textarea>
                </div>
                <div class="config-row">
                    <div class="config-group">
                        <label>字体大小</label>
                        <input type="number" data-prop="fontSize" value="${comp.props.fontSize}">
                    </div>
                    <div class="config-group">
                        <label>对齐方式</label>
                        <select data-prop="textAlign">
                            <option value="left" ${comp.props.textAlign === 'left' ? 'selected' : ''}>左对齐</option>
                            <option value="center" ${comp.props.textAlign === 'center' ? 'selected' : ''}>居中</option>
                            <option value="right" ${comp.props.textAlign === 'right' ? 'selected' : ''}>右对齐</option>
                        </select>
                    </div>
                </div>
            `;
        }

        function renderVideoConfig(comp) {
            return `
                <div class="config-group">
                    <label>视频URL</label>
                    <input type="text" data-prop="videoUrl" value="${comp.props.videoUrl}">
                </div>
                <div class="config-group">
                    <label>封面URL</label>
                    <input type="text" data-prop="posterUrl" value="${comp.props.posterUrl}">
                </div>
                <div class="config-group">
                    <label>自动播放</label>
                    <select data-prop="autoplay">
                        <option value="true" ${comp.props.autoplay ? 'selected' : ''}>是</option>
                        <option value="false" ${!comp.props.autoplay ? 'selected' : ''}>否</option>
                    </select>
                </div>
            `;
        }

        function renderCountdownConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <div class="config-group">
                    <label>结束时间</label>
                    <input type="datetime-local" data-prop="endTime" value="${comp.props.endTime}">
                </div>
            `;
        }

        function renderReviewsConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <p style="font-size:12px;color:#666;margin-bottom:10px;">${comp.props.reviews.length} 条评价</p>
            `;
        }

        function renderFaqConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <p style="font-size:12px;color:#666;margin-bottom:10px;">${comp.props.items.length} 个问题</p>
            `;
        }

        function renderContactConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <div class="config-group">
                    <label>电话</label>
                    <input type="text" data-prop="phone" value="${comp.props.phone}">
                </div>
                <div class="config-group">
                    <label>邮箱</label>
                    <input type="text" data-prop="email" value="${comp.props.email}">
                </div>
                <div class="config-group">
                    <label>地址</label>
                    <input type="text" data-prop="address" value="${comp.props.address}">
                </div>
            `;
        }

        function renderSocialConfig(comp) {
            return `
                <div class="config-group">
                    <label>标题</label>
                    <input type="text" data-prop="title" value="${comp.props.title}">
                </div>
                <p style="font-size:12px;color:#666;margin-bottom:10px;">${comp.props.platforms.length} 个平台</p>
            `;
        }

        // 移除组件
        function removeComponent(id) {
            components = components.filter(c => c.id !== id);
            if (selectedComponentId === id) {
                selectedComponentId = null;
                document.getElementById('configContent').innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 40px;">选择组件以编辑配置</p>';
            }
            renderComponents();
        }

        // 移动组件（排序）
        function moveComponent(fromId, toId) {
            if (fromId === toId) return;

            const fromIndex = components.findIndex(c => c.id === fromId);
            const toIndex = components.findIndex(c => c.id === toId);

            const [moved] = components.splice(fromIndex, 1);
            components.splice(toIndex, 0, moved);

            // 重新排序
            components.forEach((c, i) => c.order = i);
            renderComponents();
        }

        // 清空所有
        function clearAll() {
            if (!confirm('确定要清空所有组件吗？')) return;
            components = [];
            selectedComponentId = null;
            document.getElementById('configContent').innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 40px;">选择组件以编辑配置</p>';
            renderComponents();
        }

        // 加载配置
        async function loadConfig() {
            try {
                const res = await fetch(`${API_BASE}/campaign/page-config/${campaignId}`);
                const data = await res.json();

                if (data.components && data.components.length > 0) {
                    components = data.components;
                    renderComponents();
                    showToast('配置加载成功');
                }
            } catch (err) {
                console.error('加载配置失败:', err);
            }
        }

        // 保存配置
        async function saveConfig() {
            try {
                showToast('正在保存...');

                const res = await fetch(`${API_BASE}/campaign/page-config/${campaignId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        components: components,
                        theme: theme
                    })
                });

                if (!res.ok) throw new Error('保存失败');

                showToast('保存成功！');
            } catch (err) {
                console.error('保存失败:', err);
                showToast('保存失败: ' + err.message);
            }
        }

        // 预览
        function previewPage() {
            const previewContent = document.getElementById('previewContent');
            let html = '';

            components.forEach(comp => {
                html += renderPreviewComponent(comp);
            });

            previewContent.innerHTML = html || '<p style="text-align:center;color:#9ca3af;padding:40px;">暂无内容</p>';
            document.getElementById('previewModal').classList.add('active');
        }

        // 渲染预览组件
        function renderPreviewComponent(comp) {
            switch (comp.type) {
                case 'banner':
                    return `<div class="preview-banner"><img src="${comp.props.imageUrl}" alt="${comp.props.title}" style="height:${comp.props.height}px;object-fit:cover;"></div>`;
                case 'text':
                    return `<div class="preview-text" style="text-align:${comp.props.textAlign};"><h3>${comp.props.title}</h3><p>${comp.props.content}</p></div>`;
                case 'video':
                    return `<div class="preview-video" style="width:${comp.props.width};"><video controls ${comp.props.autoplay ? 'autoplay' : ''} poster="${comp.props.posterUrl}" style="width:100%;"><source src="${comp.props.videoUrl}"></video></div>`;
                case 'countdown':
                    return `<div class="preview-countdown"><h3>${comp.props.title}</h3><div class="timer" id="timer_${comp.id}">计算中...</div></div>`;
                case 'reviews':
                    const reviewsHtml = comp.props.reviews.map(r => `
                        <div class="preview-review">
                            <div style="display:flex;align-items:center;">
                                <div class="avatar"></div>
                                <span class="name">${r.name}</span>
                            </div>
                            <div class="content">${r.content}</div>
                        </div>
                    `).join('');
                    return `<h3 style="margin-bottom:15px;color:#333;">${comp.props.title}</h3>${reviewsHtml}`;
                case 'faq':
                    const faqHtml = comp.props.items.map(item => `
                        <div class="preview-faq">
                            <div class="question">Q: ${item.question}</div>
                            <div class="answer">A: ${item.answer}</div>
                        </div>
                    `).join('');
                    return `<h3 style="margin-bottom:15px;color:#333;">${comp.props.title}</h3>${faqHtml}`;
                case 'contact':
                    return `<div class="preview-contact"><h3>${comp.props.title}</h3><p><strong>电话:</strong> ${comp.props.phone}</p><p><strong>邮箱:</strong> ${comp.props.email}</p><p><strong>地址:</strong> ${comp.props.address}</p></div>`;
                case 'social':
                    const socialHtml = comp.props.platforms.map(p => `<a href="${p.url}"><i class="${p.icon}"></i></a>`).join('');
                    return `<h3 style="margin-bottom:15px;color:#333;">${comp.props.title}</h3><div class="preview-social">${socialHtml}</div>`;
                default:
                    return '';
            }
        }

        // 关闭预览
        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // 显示提示
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>