# Change: 新增分销端（大C端）角色与多级分销系统

## Why

当前系统已有4种角色：
- **P端（platform_admin）**：平台管理员，已有
- **B端（brand_admin）**：品牌管理员，已有
- **c端（participant）**：普通顾客，已有，还需完善
- **C端（distributor）**：分销商/高级顾客，**缺失**

分销商（大C端）是一种高级别的顾客角色，经过平台或品牌审批后生效，具备分享推广资格并获得推广奖励。目前该角色完全缺失，需要：
1. 定义新的分销商角色（distributor）
2. 实现分销商申请审批流程
3. 支持多级分销体系
4. 提供分销商专属的推广工具和数据查看功能

## What Changes

- **新增** `distributor` 角色定义：作为 `participant` 的高级扩展角色
- **新增** 分销商申请审批流程：顾客可申请成为分销商，由品牌管理员审批
- **新增** 多级分销体系：支持一级、二级、三级分销商，不同级别对应不同奖励比例
- **新增** 分销商专属功能：
  - 生成专属推广链接/二维码
  - 查看推广数据和奖励明细
  - 查看下级分销商列表（仅一级下级）
- **修改** RBAC权限系统：新增 `distributor` 角色权限定义
- **修改** H5端：在现有顾客H5基础上增加分销功能入口
- **新增** 管理后台：品牌管理员审批分销商申请的界面

## Impact

- **affected specs**:
  - **新增**: `distributor-system`（分销商系统）
  - **修改**: `rbac-permission-system`（新增distributor角色）
  - **修改**: `reward-system`（支持多级分销奖励计算）
- **affected code** (预估):
  - 后端：分销商数据模型、申请审批API、多级奖励计算逻辑
  - 前端管理端：分销商审批界面、分销商列表
  - H5端：分销中心页面、推广工具、数据统计

## Out of Scope

- 分销商独立小程序（本变更复用现有H5）
- 分销商PC后台管理端
- 自动升级机制（分销商级别需要手动调整）
- 复杂的团队管理功能（仅支持查看一级下级）

## Risks

- 多级分销可能涉及合规风险（需确保不超过3级）
- 奖励计算复杂度增加，可能影响性能
- 分销商与普通顾客的权限边界需清晰定义

## Mitigation

- 严格限制分销层级不超过3级（符合法规要求）
- 使用缓存优化奖励计算性能
- 明确权限矩阵，分销商只能访问自己的推广数据
- 审批流程需品牌管理员手动操作，确保质量
